function ChaZD(a,b,c,d){this.wordSource=c,this.useHttps=b;var e=(b?urls.dictHttps:urls.dict)+a,f=this,g=new XMLHttpRequest;g.open("GET",e,!0),g.onreadystatechange=function(){if(4==g.readyState){var e=JSON.parse(g.responseText);if(-1===a.indexOf("-")||f.checkErrorCode(e.errorCode).error||f.haveTranslation(e)){var h=f.parseResult.call(f,e);d(h)}else new ChaZD(a.replace(/-/g," "),b,c,d)}},g.send()}function preprocessWord(a){return-1===a.indexOf(" ")&&(a=a.replace(/_/g," "),/[a-z]+/.test(a)&&(a=trim(a.replace(/([A-Z])/g," $1")))),a}function showNotification(a){if(Notifications){var b=null;return 0===Notifications.checkPermission()?(b=Notifications.createNotification(a.icon||chrome.extension.getURL("icons/icon128.png"),a.title||"ChaZD 查字典",a.content),b.onclick=function(){window.open("https://chrome.google.com/webstore/detail/chazd/nkiipedegbhbjmajlhpegcpcaacbfggp")},b.show()):Notifications.requestPermission(),b}}ChaZD.prototype.checkErrorCode=function(a){var b={message:"",error:0,errorCode:0};switch(a){case 0:b.message="query success";break;case 20:b.message="要翻译的文本过长",b.error=1,b.errorCode=20;break;case 30:b.message="无法进行有效的翻译",b.error=1,b.errorCode=30;break;case 40:b.message="不支持的语言类型",b.error=1,b.errorCode=40;break;case 50:b.message="无效的key",b.error=1,b.errorCode=50;break;case 60:b.message="无辞典结果",b.error=1,b.errorCode=60}return b},ChaZD.prototype.parseResult=function(a){var b={},c=this.checkErrorCode(a.errorCode);if(b.haveWebTranslation=!1,c.error)b.errorCode=c.errorCode;else{var d=this.initTitle(a);if(b.titleBlock=d.titleBlock,b.haveTranslation=this.haveTranslation(a),void 0!==a.basic){var e=this.parseBasicResult(a);b.basicBlock=e}if(void 0!==a.web){var f=this.parseWebResult(a);b.haveWebTranslation=!0,b.webBlock=f}}return b.validMessage=c.message,b},ChaZD.prototype.haveTranslation=function(a){if(this.checkErrorCode(a.errorCode).error)return!1;var b=a.translation,c=a.query;return trim(c.toLowerCase())!==trim(b.toString().toLowerCase())},ChaZD.prototype.initTitle=function(a){var b=a.translation,c=a.query,d=this.initVoice(c);c=c.length>=50&&"select"==this.wordSource?this.shortWord(c):c;var e=fmt(frame.titleWord,c,d),f=fmt(frame.titleTranslation,b.toString());return{titleBlock:fmt(frame.titleContainer,e,f,c.length>=50?"long-text":"")}},ChaZD.prototype.shortWord=function(a){return a.slice(0,a.lastIndexOf(" ",50)).concat(" ...")},ChaZD.prototype.parseBasicResult=function(a){var b=a.basic,c=a.query,d=this.parseBasicPhonetic(b,c),e=this.parseBasicExplains(b,c);return fmt(frame.basicContainer,d,e)},ChaZD.prototype.parseBasicPhonetic=function(a,b){var c=a["uk-phonetic"],d=a["us-phonetic"];if(void 0!==c&&void 0!==d){var e=this.initVoice(b,1),f=fmt(frame.ukPhoneticContainer,"["+c+"]"+e),g=this.initVoice(b,2),h=fmt(frame.usPhoneticContainer,"["+d+"]"+g);return fmt(frame.phoneticContainer,f,h)}return fmt(frame.phoneticContainer,"","")},ChaZD.prototype.initVoice=function(a,b){var c=(this.useHttps?urls.voiceHttps:urls.voice)+a;void 0!==b&&(c=c+"&type="+b);var d="";return d=1===b?"英音":2===b?"美音":"真人发音",fmt(frame.voiceContainer,c,d)},ChaZD.prototype.parseBasicExplains=function(a,b){var c,d=a.explains,e="";for(c=0;c<d.length;c++){var f=d[c],g=f.indexOf(". "),h=-1!==g?f.slice(0,g+1):"",i=this.parseProperty(h),j=fmt(frame.propertyContainer,i,h),k=-1!==g?f.slice(g+1):f;e+=fmt(frame.explain,j,k)}return fmt(frame.explainsContainer,fmt(frame.explainsList,e))},ChaZD.prototype.parseProperty=function(a){var b="";switch(a){case"adj.":b="形容词";break;case"adv.":b="副词";break;case"n.":b="名词";break;case"vi.":b="不及物动词";break;case"vt.":b="及物动词";break;case"prep.":b="介词";break;case"conj.":b="连词";break;case"int.":b="感叹词";break;case"abbr.":b="代词";break;case"pron.":b=""}return b},ChaZD.prototype.parseWebResult=function(a){var b,c=a.web,d="";for(b=0;b<c.length;b++){d+=fmt(frame.webExplain,c[b].key,c[b].value)}return fmt(frame.webExplainsContainer,fmt(frame.webExplainsList,d))},window.Notifications=window.Notifications||window.webkitNotifications,chrome.runtime.onInstalled.addListener(function(a){"install"===a.reason?showNotification({title:"感谢支持 ChaZD ！",content:"ChaZD 力求成为最简洁易用的 Chrome 词典扩展，欢迎提出您的意见或建议。如果觉得 ChaZD 还不错，记得给5星好评哦:)"}):"update"===a.reason&&(chrome.storage.sync.set({showTips:!0},function(){}),showNotification({title:"ChaZD 更新到0.8.19版！",content:"修复若干 bug，如出现无法查词的问题，请在设置中关闭使用 HTTPS 接口"}))}),chrome.storage.sync.get(null,function(a){if(void 0===a.showTips)chrome.storage.sync.set(settings);else{for(var b in a)void 0===settings[b]?chrome.storage.sync.remove(b):settings[b]=a[b];chrome.storage.sync.set(settings)}}),chrome.runtime.onMessage.addListener(function(a,b,c){return new ChaZD(preprocessWord(a.queryWord),a.useHttps,a.source,c),!0});